configVersion: 3
environment: production

# 1. 数据连接层：作为 RCAgent 的专家工具数据源
connectors:
  - file: connectorRIS
    name: ris
    params:
      carefulSubscription: true
      url: ws://ris-live.ripe.net/v1/ws/
      perMessageDeflate: true
      subscription:
        moreSpecific: true
        type: UPDATE
        host: null
        socketOptions:
          includeRaw: true # 修改：包含原始 BGP 数据，为 LLM 提供更丰富的上下文

# 2. 监测模块：实现 LogSage 的“故障提取” (FILE)，过滤无用 BGP 噪声 [cite: 604]
monitors:
  - file: monitorHijack
    channel: hijack
    name: basic-hijack-detection
    params:
      thresholdMinPeers: 3
  - file: monitorPath
    channel: path
    name: path-matching
    params:
      thresholdMinPeers: 1
  - file: monitorNewPrefix
    channel: newprefix
    name: prefix-detection
    params:
      thresholdMinPeers: 3
  - file: monitorVisibility
    channel: visibility
    name: withdrawal-detection
    params:
      thresholdMinPeers: 10 # 修改：调低阈值以捕获更多潜在的细微异常，交给大模型甄别
      notificationIntervalSeconds: 3600
  - file: monitorAS
    channel: misconfiguration
    name: asn-monitor # 核心：用于监测你指定的特定 AS
    params:
      skipPrefixMatch: false
      thresholdMinPeers: 3
  - file: monitorRPKI
    channel: rpki
    name: rpki-monitor
    params:
      thresholdMinPeers: 3
  - file: monitorPathNeighbors
    channel: path
    name: path-neighbors # 关键：用于分析 AS 拓扑关系的变化
    params:
      thresholdMinPeers: 3

# 3. 报告模块：为 Python 控制器提供结构化交互界面 [cite: 127]
reports:
  - file: reportFile
    channels:
      - hijack
      - newprefix
      - visibility
      - path
      - misconfiguration
      - rpki
    params:
      filename: logs/bgp_alerts.log # 修改：固定的日志路径，方便 Python 脚本实时监听
      persistent: true

  - file: reportRest
    channels: # 增加：通过 REST API 实时推送告警给你的 Python 诊断脚本
      - hijack
      - path
      - misconfiguration
    params:
      url: http://localhost:5000/webhook # 假设你的 Python 接收器运行在 5000 端口

# 4. 基础设置
notificationIntervalSeconds: 60 # 修改：缩短间隔，提高实时性
alarmOnlyOnce: false # 修改：设为 false，确保大模型能看到异常的完整演进过程
monitoredPrefixesFiles:
  - prefixes.yml
persistStatus: true
generatePrefixListEveryDays: 0

logging:
  directory: logs
  logRotatePattern: YYYY-MM-DD
  maxRetainedFiles: 10
  maxFileSizeMB: 15
  compressOnRotation: false

# 5. REST 接口配置：允许大模型主动查询当前状态 [cite: 128]
rest:
  host: localhost
  port: 8011

checkForUpdatesAtBoot: true
pidFile: bgpalerter.pid
fadeOffSeconds: 360
checkFadeOffGroupsSeconds: 30